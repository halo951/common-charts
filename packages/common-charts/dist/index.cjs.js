/** common-charts
 *
 * @author halo951(https://github.com/halo951)
 * @license MIT
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("vue"),t=require("echarts");const r=new class{pool=[];push(e){this.pool.push(e),this.execute()}lock=!1;execute(){if(!this.lock){for(;this.pool.length>0;)try{const e=this.pool.pop();requestAnimationFrame(e)}catch(e){console.error(e)}this.lock=!1}}},n={firstRenderSleep:0,clear:!1,renderer:(()=>{const e=navigator.userAgent.toLowerCase();return/mobile/.test(e)?"svg":"canvas"})()},o=e.defineComponent({name:"Chart",props:{options:{type:Object,default:()=>({})},firstRenderSleep:{type:Number,default:()=>n.firstRenderSleep},clear:{type:Boolean,default:()=>n.clear},renderer:{type:String,default:()=>n.renderer}},setup(n,{}){const o=e.ref(null),i=e.ref(0),s=e.ref(),a=async()=>{var e;o.value&&(i.value>Date.now()&&await(e=i.value-Date.now(),new Promise((t=>setTimeout((()=>t()),e)))),r.push((()=>o.value?.setOption(n.options??{}))))},l=e=>{e.position||(e.confine=!0,e.position=function(e,t,r){if(r instanceof HTMLElement){if(r.getBoundingClientRect().left<0)return"right";if(r.getBoundingClientRect().right>window.innerWidth-r.clientWidth)return"left"}return"inside"})},p=()=>{o.value?.resize()};return e.watch(e.ref(n.options),(()=>(()=>{if(!o.value)return;n.clear&&o.value.clear();const{tooltip:e}=n.options;if(e)if(e instanceof Array)for(const t of e)l(t);else l(e);a()})())),e.onMounted((()=>{i.value=n.firstRenderSleep+Date.now(),o.value=t.init(s.value,"default",{renderer:n.renderer}),n.options&&a(),window.addEventListener("resize",p)})),e.onBeforeUnmount((()=>{o.value&&!o.value.isDisposed()&&(o.value.dispose(),window.removeEventListener("resize",p))})),{el:s}},render:()=>e.h("div",{ref:"el",class:"chart"})}),i=e=>{const{r:t,y:r}=e;return{type:"pie",radius:[t-10,t],center:["50%",r+t],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"12",fontWeight:"bold"}},emptyCircleStyle:{color:"#D1EBFF"}}},s=e=>({"完好率":"%","工单数":"个","分项得分":"分","分项问题数":"个","已完成培训商户数":"户","未完成培训商户数":"户"}[e]??""),a=e=>{const t={};var r;return t.position="right",t.formatter=e=>{e=e instanceof Array?e[0]:e,r&&(e.percent=r(e));const t=s(e.seriesName);return[`<span style='margin-left:8px; margin-right: 12px; font-size: 12px; color:#fff;'>${e.data[0]}</span>`,` <span style='font-size: 14px; color:#fff; margin-top: 4px;'>${e.data[1]}${t}&nbsp;&nbsp;&nbsp;${e.percent}%</span>`].join("<br />")},t},l=(e,t)=>{const{r:r,x:n,y:o}=t;return{icon:"circle",itemWidth:8,itemHeight:8,itemGap:12,width:2*(r+n)-20,height:24*Math.ceil(e.length/2),left:"center",top:2*r+o+17,orient:"vertical",textStyle:{fontFamily:"PingFang SC",fontStyle:"normal",fontWeight:400,fontSize:12,padding:[0,0,0,4]},formatter:t=>{let r=""+e.find((e=>e[0]===t))?.[1];return r=t+" "+r,r.length<8&&(r+=new Array(10-r.length).fill(" ").join("")),r}}},p=["#0091FF","#00D6B9","#F58300","#AD82F7","#B3D600","#F76B64","#FFC60A","#00AB4A"];exports.Chart=o,exports.createPieChart=e=>{const t={};var r;return(e=>{e.animationDuration=1e3,e.animationDurationUpdate=700,e.animationEasingUpdate="cubicInOut"})(t),(e=>{e.color=p})(t),t.title=[(r=e.title,{text:r,left:-4,textStyle:{fontFamily:"PingFang SC",fontStyle:"normal",fontWeight:400,fontSize:12}})],t.legend=[l(e.source,e.position)],t.tooltip=a(e.unit),t.series=[i(e.position)],t.dataset={source:e.source},t},exports.setClear=e=>{n.clear=e},exports.setFirstRenderSleep=e=>{n.firstRenderSleep=e},exports.setRenderer=e=>{n.renderer=e};
